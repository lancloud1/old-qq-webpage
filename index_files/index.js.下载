!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("AegisReport",[],n):"object"==typeof exports?exports.AegisReport=n():e.AegisReport=n()}(window,(function(){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(o,i,function(n){return e[n]}.bind(null,i));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e,n,t){e.exports=function(){"use strict";var e,n;function t(n){this.name="__st"+(1e9*Math.random()>>>0)+e+"__",null!=n&&n.forEach(this.add,this),e+=1}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var n=Object(this),t=n.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var o=arguments[1],i=0;i<t;){var r=n[i];if(e.call(o,r,i,n))return r;i+=1}}}),window.WeakSet||(e=Date.now()%1e9,t.prototype.add=function(e){var n=this.name;return e[n]||Object.defineProperty(e,n,{value:!0,writable:!0}),this},t.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},t.prototype.has=function(e){return!!e[this.name]},n=t,Object.defineProperty(window,"WeakSet",{value:function(e){return new n(e)}})),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),t=1;t<arguments.length;t++)if(null!=(o=arguments[t]))for(var o=Object(o),i=Object.keys(Object(o)),r=0,a=i.length;r<a;r++){var s=i[r],c=Object.getOwnPropertyDescriptor(o,s);null!=c&&c.enumerable&&(n[s]=o[s])}return n}});var o=function(e,n){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,n){e.__proto__=n}:function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}))(e,n)},i=function(){return(i=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function r(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var o=Array(e),i=0;for(n=0;n<t;n++)for(var r=arguments[n],a=0,s=r.length;a<s;a++,i++)o[i]=r[a];return o}function a(e){try{return encodeURIComponent(decodeURIComponent(e))}catch(n){return e}}var s,c=/_?t(\d)?(imestamp)?=\d+&?/g,u=["/collect/offlineAuto","/aegis-sdk","/flog.core.min.js","pingfore.qq.com/pingd","h.trace.qq.com/kv","beacon.qq.com","tpstelemetry.tencent.com","insight.cloud.tencent.com","www.googletagmanager.com","report.idqqimg.com","google-analytics.com","arms-retcode.aliyuncs.com","px.effirst.com","sentry","hot-update.json","u.c.b.r.o.w.s.e.r","report.url.cn","sockjs-node"],l=["ext1","ext2","ext3","level","trace","tag","seq","code"],f=["static","fetch"],d=(h.prototype.indexOf=function(e,n){for(var t=0;t<e.length;t++)if(e[t].callback===n)return t;return-1},h.prototype.on=function(e,n,t){var o;if(void 0===t&&(t=0),this)return(o=this.eventsList[e])||(this.eventsList[e]=[],o=this.eventsList[e]),-1===this.indexOf(o,n)&&o.push({name:e,type:t||0,callback:n}),this},h.prototype.one=function(e,n){this.on(e,n,1)},h.prototype.remove=function(e,n){if(this){var t=this.eventsList[e];if(t){if(n)return t.length&&(n=this.indexOf(t,n),t.splice(n,1)),this;try{delete this.eventsList[e]}catch(e){}}return null}},h.prototype.clear=function(){this.eventsList={}},h),p=function(e){if(!e||0===e.length)return"{}";e=Array.isArray(e)?e:[e];var n=Object.keys(e[0]),t={};return n.forEach((function(n){t[n]=e.map((function(e){return e[n]}))})),t.count=e.length,F(t)};function h(){var e=this;this.emit=function(n,t){if(e){var o;if(null!=(i=e.eventsList[n])&&i.length)for(var i=i.slice(),r=0;r<i.length;r++){o=i[r];try{var a=o.callback.apply(e,[t]);if(1===o.type&&e.remove(n,o.callback),!1===a)break}catch(n){throw n}}return e}},this.eventsList={}}function g(e,n){return"number"==typeof e||"string"==typeof e?e:n?s.string:s.number}function m(e,n){return"string"==typeof e?e.split("?")[n?1:0]||"":e}function v(e,n){return void 0===n&&(n=2048),String(e).replace(c,"").slice(0,n)}function y(e){return"string"==typeof e&&/^\//.test(e)?"https:"===(null===location||void 0===location?void 0:location.protocol):/^https/.test(e)}function w(e,n,t){var o,i;try{if("function"==typeof(null==n?void 0:n.retCodeHandler))return{code:void 0===(r=(i=n.retCodeHandler(e,null==t?void 0:t.url,null==t?void 0:t.ctx,null==t?void 0:t.payload)||{}).code)?"unknown":r,isErr:i.isErr};"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof(null==(o=null==n?void 0:n.ret)?void 0:o.join)&&(U=[].concat(n.ret.map((function(e){return e.toLowerCase()}))));var r,a=Object.getOwnPropertyNames(e).filter((function(e){return-1!==U.indexOf(e.toLowerCase())}));return a.length?{code:""+(r=e[a[0]]),isErr:0!==r&&"0"!==r}:{code:"unknown",isErr:!1}}catch(e){return{code:"unknown",isErr:!1}}}function b(e,n,t){try{var o="function"==typeof n?n(e,null==t?void 0:t.url)||"":e;return D(o).slice(0,102400)}catch(e){return""}}function E(e,n){return"string"!=typeof e||!e||n&&-1<e.indexOf(n)||X.test(e)||u.some((function(n){return-1<e.indexOf(n)}))}function R(e,n){var t,o=[],i=e.config;return e.lifeCycle.on("destroy",(function(){o.length=0})),function(r,a){Array.isArray(r)?o=o.concat(r):o.push(r),n&&o.length>=n||e.sendNow&&0<o.length?(o=V(o),a(o.splice(0,o.length)),t&&clearTimeout(t)):(t&&clearTimeout(t),t=setTimeout((function(){t=null,0<(o=V(o)).length&&a(o.splice(0,o.length))}),i.delay))}}function O(e,n){return Array.isArray(e)?n(e.map((function(e){return n=i(i({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(B).join(" ")}),l.forEach((function(e){n[e]||delete n[e]})),n;var n}))):n([i(i({},e),{msg:"string"==typeof e.msg?e.msg:B(e.msg)})])}function T(e,n){return function(t,o){var r,a,s,c=Array.isArray(t),u=c?t:[t],f=(e.lifeCycle.emit("beforeRequest",t),e.config.beforeRequest);(u="function"==typeof f?u.map((function(e){try{var t=f({logs:e,logType:n});return(null==t?void 0:t.logType)===n&&null!=t&&t.logs?t.logs:!1!==t&&e}catch(t){return e}})).filter((function(e){return!1!==e})):u).length&&(r=u,t=l,!Array.isArray(r)||r.length<=1||(a=[],s=[],!(s="string"==typeof t?[t]:t))||s.length<=0||(s.forEach((function(e){r.forEach((function(n){null!=n&&n[e]&&a.push(e)}))})),0<a.length&&(r=r.map((function(e){var n={};return a.forEach((function(e){n[e]=""})),i(i({},n),e)})))),u=r,o(c?u:u[0]))}}function S(e){return function(n,t){e.lifeCycle.emit("modifyRequest",n);var o=e.config.modifyRequest;if("function"==typeof o)try{var i=o(n);"object"==typeof i&&"url"in i&&(n=i)}catch(n){console.error(n)}t(n)}}function P(e){return function(n,t){null!=(o=e.lifeCycle)&&o.emit("afterRequest",n);var o=(e.config||{}).afterRequest;"function"==typeof o&&!1===o(n)||t(n)}}function L(e){if(e&&e.reduce&&e.length)return 1===e.length?function(n,t){e[0](n,t||z)}:e.reduce((function(e,n){return function(t,o){return void 0===o&&(o=z),e(t,(function(e){return null==n?void 0:n(e,o)}))}}));throw new TypeError("createPipeline need at least one function param")}function x(e,n){Object.getOwnPropertyNames(e).forEach((function(t){"function"==typeof e[t]&&"constructor"!==t&&(n?n[t]="sendPipeline"===t?function(){return function(){}}:function(){}:e[t]=function(){})}))}function C(){return void 0!==window.performance&&"function"==typeof performance.clearResourceTimings&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function k(e,n){function t(o){"pagehide"!==o.type&&"hidden"!==document.visibilityState||(e(o),n&&(removeEventListener("visibilitychange",t,!0),removeEventListener("pagehide",t,!0)))}addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)}function A(e){return-1!==re.indexOf(e)}(Z=s=s||{})[Z.number=-1]="number",Z.string="";var I,N,_,j=["application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/x-javascript","application/ecmascript","application/vnd.mspowerpoint","application/vnd.apple.mpegurl","application/ogg","text/css","text/javascript","image","audio","video","video/mp2t"],q=/\.(json|js|css|jpg|jpeg|png|svg|apng|webp|gif|bmp|mp4|mp3|ts|mpeg|wav|webm|ogg|flv|m3u8|ttf|woff2|otf|eot|woff|html|htm|shtml|shtm|)$/gi,U=["ret","retcode","code","errcode"],H=function(){var e=new WeakSet;return function(n,t){if(t instanceof Error)return"Error.message: "+t.message+" \n  Error.stack: "+t.stack;if("object"==typeof t&&null!==t){if(e.has(t))return"[Circular "+(n||"root")+"]";e.add(t)}return t}},B=function(e){if("string"==typeof e)return e;try{return e instanceof Error?(JSON.stringify(e,H(),4)||"undefined").replace(/"/gim,""):JSON.stringify(e,H(),4)||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},F=function(e){if("string"==typeof e)return e;try{return JSON.stringify(e,H())||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},D=function(e,n){void 0===n&&(n=3);var t,o,i,r="";return Array.isArray(e)?(r+="[",t=e.length,e.forEach((function(e,o){r=(r+="object"==typeof e&&1<n?D(e,n-1):W(e))+(o===t-1?"":",")})),r+="]"):e instanceof Object?(r="{",o=Object.keys(e),i=o.length,o.forEach((function(t,a){"object"==typeof e[t]&&1<n?r+='"'+t+'":'+D(e[t],n-1):r+=M(t,e[t]),r+=a===i-1||a<i-1&&void 0===e[o[a+1]]?"":","})),r+="}"):r+=e,r},M=function(e,n){var t=typeof n,o="";return"string"==t||"object"==t?o+='"'+e+'":"'+n+'"':"function"==typeof n?o+='"'+e+'":"function '+n.name+'"':"symbol"==typeof n?o+='"'+e+'":"symbol"':"number"!=typeof n&&"boolean"!=t||(o+='"'+e+'": '+n),o},W=function(e){var n=typeof e;return""+("undefined"==n||"symbol"==n||"function"==n?"null":"string"==n||"object"==n?'"'+e+'"':e)},X=/data:(image|text)\/.*;base64/,V=((Z=I=I||{}).INFO_ALL="-1",Z.API_RESPONSE="1",Z.INFO="2",Z.ERROR="4",Z.PROMISE_ERROR="8",Z.AJAX_ERROR="16",Z.SCRIPT_ERROR="32",Z.IMAGE_ERROR="64",Z.CSS_ERROR="128",Z.CONSOLE_ERROR="256",Z.MEDIA_ERROR="512",Z.RET_ERROR="1024",Z.REPORT="2048",Z.PV="4096",Z.EVENT="8192",Z.PAGE_NOT_FOUND_ERROR="16384",Z.WEBSOCKET_ERROR="32768",Z.BRIDGE_ERROR="65536",(Z=N=N||{}).LOG="log",Z.SPEED="speed",Z.PERFORMANCE="performance",Z.OFFLINE="offline",Z.WHITE_LIST="whiteList",Z.VITALS="vitals",Z.PV="pv",Z.CUSTOM_PV="customPV",Z.EVENT="event",Z.CUSTOM="custom",Z.SDK_ERROR="sdkError",Z.SET_DATA="setData",Z.LOAD_PACKAGE="loadPackage",(Z=_=_||{}).production="production",Z.development="development",Z.gray="gray",Z.pre="pre",Z.daily="daily",Z.local="local",Z.test="test",Z.others="others",function(e){return e.filter((function(n,t){return"static"!==n.type||!e.find((function(e,o){return n.url===e.url&&200===n.status&&t<o}))}))}),G=function(e){e.level===I.INFO_ALL&&(e.level=I.INFO)},J={},$={},K=function(e){return J[e]||(J[e]=setTimeout((function(){$[e]={},J[e]=null}),6e4)),J[e]},Q=function(e){return(Array.isArray(e)?e:[e]).map((function(e){return Object.getOwnPropertyNames(e).reduce((function(n,t){return"ctx"!==t&&(n[t]=e[t]),n}),{level:I.INFO,msg:""})}))},Y=function(e){return function(n){return e.sendPipeline([function(n,t){return t({url:e.config.url||"",data:p(Q(n)),method:"post",contentType:"application/json",type:N.LOG,log:n,requestConfig:{timeout:5e3},success:function(){var o=e.config.onReport;"function"==typeof o&&n.forEach((function(e){o(e)})),"function"==typeof t&&t([])}})}],N.LOG)(n)}},z=function(){},Z=(Object.defineProperty(ce.prototype,"__version__",{get:function(){return console.warn("__version__ has discard, please use version"),"1.38.70"},enumerable:!1,configurable:!0}),Object.defineProperty(ce.prototype,"LogType",{get:function(){return console.warn("LogType has discard, please use logType"),I},enumerable:!1,configurable:!0}),ce.prototype.init=function(e){this.setConfig(e);for(var n=0;n<ce.installedPlugins.length;n++)try{ce.installedPlugins[n].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},ce.prototype.setConfig=function(e){Object.assign(this.config,e);var n=(e=this.config).id,t=e.uin,o=e.version,i=e.ext1,r=e.ext2,a=e.ext3,s=e.aid,c=void 0===(u=e.env)?"production":u,u=e.pageUrl;return e=this.bean.id!==n||this.bean.uin!==t||this.bean.aid!==s,this.bean.id=n||"",this.bean.uin=t||"",this.bean.version=o||"1.38.70",this.bean.aid=s||"",this.bean.env=function(){switch(c){case _.production:case _.development:case _.gray:case _.pre:case _.daily:case _.local:case _.test:case _.others:return 1;default:return}}()?c:_.others,u&&this.extendBean("from",encodeURIComponent(u.slice(0,2048))),i&&this.extendBean("ext1",encodeURIComponent(i)),r&&this.extendBean("ext2",encodeURIComponent(r)),a&&this.extendBean("ext3",encodeURIComponent(a)),e&&this.lifeCycle.emit("onConfigChange",this.config),this.config},ce.use=function(e){-1===ce.installedPlugins.indexOf(e)&&e.aegisPlugin&&ce.installedPlugins.push(e)},ce.unuse=function(e){-1!==(e=ce.installedPlugins.indexOf(e))&&ce.installedPlugins.splice(e,1)},ce.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t={level:I.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(t,i({},e[0]),{level:I.INFO}),this.normalLogPipeline(t)},ce.prototype.infoAll=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t={level:I.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(t,i({},e[0]),{level:I.INFO_ALL}),this.normalLogPipeline(t)},ce.prototype.report=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t={level:I.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(t,i({},e[0])),this.normalLogPipeline(t)},ce.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t={level:I.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(t,i({},e[0]),{level:I.ERROR}),this.normalLogPipeline(t)},ce.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},ce.prototype.reportPv=function(e){var n,t=this;e&&(console.warn("reportPv is deprecated, please use reportEvent"),n=""+Object.getOwnPropertyNames(this.bean).filter((function(e){return"id"!==e})).map((function(e){return e+"="+t.bean[e]})).join("&"),this.sendPipeline([function(o,i){i({url:t.config.url+"/"+e+"?"+n,addBean:!1,type:N.CUSTOM_PV})}],N.CUSTOM_PV)(null))},ce.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?this.eventPipeline(e):console.warn("reportEvent params error"))},ce.prototype.reportTime=function(e,n){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof n?n<0||6e4<n?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,n):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},ce.prototype.reportT=function(e){var n=e.name,t=e.duration,o=void 0===(o=e.ext1)?"":o,i=void 0===(i=e.ext2)?"":i,r=void 0===(r=e.ext3)?"":r;if(e=e.from,"string"==typeof n&&"number"==typeof t&&"string"==typeof o&&"string"==typeof i&&"string"==typeof r){if(!(t<0||6e4<t))return this.submitCustomTime(n,t,o,i,r,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},ce.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},ce.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},ce.prototype.submitCustomTime=function(e,n,t,o,i,r){this.customTimePipeline({name:e,duration:n,ext1:t||this.config.ext1,ext2:o||this.config.ext2,ext3:i||this.config.ext3,from:r||void 0})},ce.prototype.extendBean=function(e,n){this.bean[e]=n},ce.prototype.sendPipeline=function(e,n){var t,o=this;return L(r([function(e,n){if("number"!=typeof t.config.random&&(console.warn("random must in [0, 1], default is 1."),t.config.random=1),!t.isHidden||!t.isGetSample)if(t.isGetSample)t.isHidden||n(e);else{if(t.isGetSample=!0,Math.random()<t.config.random)return t.isHidden=!1,n(e);t.isHidden=!0}},T(t=this,n)],e,[S(this),function(e,n){o.request(e,(function(){for(var t,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];o.failRequestCount=0,n({isErr:!1,result:i,logType:null==e?void 0:e.type,logs:null==e?void 0:e.log}),null!=(t=null==e?void 0:e.success)&&t.call.apply(t,r([e],i))}),(function(){for(var t,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];60<=++o.failRequestCount&&o.destroy(),-1<(""+i[0]).indexOf("403 forbidden")&&o.destroy(),n({isErr:!0,result:i,logType:null==e?void 0:e.type,logs:null==e?void 0:e.log}),null!=(t=null==e?void 0:e.fail)&&t.call.apply(t,r([e],i))}))},P(this)]))},ce.prototype.send=function(e,n,t){var o=this;return L([S(this),function(e,i){o.request(e,(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];i({isErr:!1,result:t,logType:e.type,logs:e.log}),null!=n&&n.apply(void 0,t)}),(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];i({isErr:!0,result:n,logType:e.type,logs:e.log}),null!=t&&t.apply(void 0,n)}))},P(this)])(e)},ce.prototype.ready=function(e,n,t){throw new Error('You need to override "ready" method')},ce.prototype.request=function(e,n,t){throw new Error('You need to override "request" method')},ce.prototype.sendSDKError=function(e){var n=this;this.sendPipeline([function(e,t){t({url:n.config.url+"?id=1085&msg[0]="+encodeURIComponent(B(e))+"&level[0]=2&from="+n.config.id+"&count=1&version="+n.config.id+"(1.38.70)",addBean:!1,method:"get",type:N.SDK_ERROR,log:e})}],N.SDK_ERROR)(e)},ce.prototype.destroy=function(e){void 0===e&&(e=!1);var n,t,o=ce.instances.indexOf(this);-1!==o&&ce.instances.splice(o,1);for(var i=ce.installedPlugins.length-1;0<=i;i--)try{ce.installedPlugins[i].unpatch(this)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)n=this,t=Object.getOwnPropertyDescriptors(n),Object.keys(t).forEach((function(e){t[e].writable&&(n[e]=null)})),Object.setPrototypeOf(this,null);else{for(var r=this;r.constructor!==Object&&x(r,this),r=Object.getPrototypeOf(r););0===ce.instances.length&&(x(o=Object.getPrototypeOf(this).constructor),x(ce))}},ce.version="1.38.70",ce.instances=[],ce.logType=I,ce.environment=_,ce.installedPlugins=[],ce),ee=(se.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},se.prototype.unpatch=function(e){var n=this.instances.indexOf(e);-1!==n&&(this.instances.splice(n,1),0===this.instances.length)&&this.uninstall(e)},se.prototype.countInstance=function(){return this.instances.length},se.prototype.uninstall=function(e){var n;null!=(n=null==(n=this.option)?void 0:n.destroy)&&n.apply(this,[e])},se.prototype.walk=function(e){var n=this;this.instances.forEach((function(t){var o=n.canUse(t);o&&e(t,o)}))},se.prototype.canUse=function(e){return!(!(e=this.getConfig(e))||"object"!=typeof e)||!!e},se.prototype.getConfig=function(e){return null==(e=e.config)?void 0:e[this.name]},se.prototype.exist=function(e){return-1===this.instances.indexOf(e)},se.prototype.triggerInit=function(e){var n;this.inited||(this.inited=!0,null==(n=null==(n=this.option)?void 0:n.init))||n.call(this.option,this.getConfig(e))},se.prototype.triggerOnNewAegis=function(e){var n;null!=(n=null==(n=this.option)?void 0:n.onNewAegis)&&n.call(this.option,e,this.getConfig(e))},se),ne=new ee({name:"aid",aid:"",init:function(e){try{var n=!0!==e&&e||window.localStorage.getItem("AEGIS_ID");n||(n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)})),window.localStorage.setItem("AEGIS_ID",n)),this.aid=n}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}}),te=function(e){var n;return e.payload?(n={},Object.keys(e).forEach((function(t){"payload"!==t&&(n[t]=e[t])})),n):e},oe=new ee({name:"reportAssetSpeed"}),ie=oe=new ee({name:"reportAssetSpeed",collectCur:0,collectEntryType:"resource",ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],onNewAegis:function(e){var n=this;C()&&(this.collectSuccessLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){n.collectCur=0,performance.clearResourceTimings()})},publish:function(e){this.$walk((function(n){n.speedLogPipeline(e)}))},publishMany:function(e,n){for(var t=n.config,o=0,i=e.length;o<i;o++){var r=e[o];-1===this.ASSETS_INITIATOR_TYPE.indexOf(r.initiatorType)||E(r.name,t.hostUrl)||this.publish(this.generateLog(r,t))}},collectSuccessLog:function(e){var n,t,o=this;"function"==typeof window.PerformanceObserver?(this.publishMany(performance.getEntriesByType(this.collectEntryType),e),(n=new window.PerformanceObserver((function(n){o.publishMany(n.getEntries(),e)}))).observe({entryTypes:[this.collectEntryType]}),e.lifeCycle.on("destroy",(function(){0===oe.countInstance()&&n.disconnect()}))):(t=setInterval((function(){var n=performance.getEntriesByType(o.collectEntryType),t=n.slice(o.collectCur);o.collectCur=n.length,o.publishMany(t,e)}),3e3),e.lifeCycle.on("destroy",(function(){0===oe.countInstance()&&clearInterval(t)})))},collectFailLog:function(e){function n(e){var n,i;e&&(e=e.target||e.srcElement,!(n=(null==e?void 0:e.src)||(null==e?void 0:e.href))||"string"!=typeof n||-1<window.location.href.indexOf(n)||(e="function"==typeof(null==(e=o.api)?void 0:e.resourceTypeHandler)?null==(e=o.api)?void 0:e.resourceTypeHandler(n):"",i=performance.getEntriesByType(t.collectEntryType).find((function(e){return e.name===n})),E(n,o.hostUrl))||(i={url:v(n),status:400,duration:Number(((null==i?void 0:i.duration)||0).toFixed(2)),method:"get",type:e||"static",isHttps:y(n),urlQuery:m(n,!0),nextHopProtocol:"",domainLookup:0,connectTime:0},t.publish(i)))}var t=this,o=e.config;window.document.addEventListener("error",n,!0),e.lifeCycle.on("destroy",(function(){0===oe.countInstance()&&window.document.removeEventListener("error",n,!0)}))},generateLog:function(e,n){n="function"==typeof(null==(t=n.api)?void 0:t.resourceTypeHandler)?null==(t=n.api)?void 0:t.resourceTypeHandler(e.name):"";var t=e.transferSize;return{url:v(e.name),method:"get",duration:Number(e.duration.toFixed(2)),status:200,type:n||"static",isHttps:y(e.name),nextHopProtocol:e.nextHopProtocol||"",urlQuery:m(e.name,!0),domainLookup:g(e.domainLookupEnd-e.domainLookupStart),connectTime:g(e.connectEnd-e.connectStart),transferSize:0<t?t:-1}},collectNotReportedLog:function(e){var n,t;C()&&(n=(t=performance.getEntriesByType(this.collectEntryType)).length,"function"!=typeof window.PerformanceObserver)&&this.collectCur!==n&&(t=t.slice(this.collectCur),this.collectCur=n,this.publishMany(t,e,!0))},destroy:function(){this.option.publish=function(){}}}),re=window.navigator.userAgent.toLowerCase(),ae={};function se(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function ce(e){var n,t,o,i,r,a,s,c,u,l,f,p,h,g,m=this;this.isGetSample=!1,this.isHidden=!1,this.config={version:0,delay:1e3,onError:!0,repeat:60,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,onClose:!0,reportLoadPackageSpeed:!0,hostUrl:"https://aegis.qq.com",env:"production",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",eventUrl:"",setDataReportUrl:"",reportImmediately:!0},this.isWhiteList=!1,this.lifeCycle=new d,this.bean={},this.originFireUrl="",this.normalLogPipeline=L([R(this,5),O,function(e,t){var o=n.config;t(e=e.map((function(e){var n,t=o.maxLength||102400;try{if(!e.msg||e.msg.length<=t)return e;e.msg=null==(n=e.msg)?void 0:n.substring(0,t)}catch(n){e.msg=B(e.msg).substring(0,o.maxLength)}return e})))},(g=(n=this).config,function(e,n){var t="number"==typeof g.repeat?g.repeat:60;if(t<=0)return n(e);var o=(null==g?void 0:g.id)+"_error",i=$[o]||{};n(e.filter((function(e){if(e.level===I.ERROR||e.level===I.PROMISE_ERROR||e.level===I.AJAX_ERROR||e.level===I.SCRIPT_ERROR||e.level===I.IMAGE_ERROR||e.level===I.CSS_ERROR||e.level===I.MEDIA_ERROR||e.level===I.RET_ERROR||e.level===I.BRIDGE_ERROR||e.level===I.PAGE_NOT_FOUND_ERROR||e.level===I.WEBSOCKET_ERROR){if(e=e.msg.slice(0,200),i[e]>t)return J[o]||K(o),!1;i[e]=1+~~i[e],$[o]=i}return!0})))}),(p=this.lifeCycle.emit,h=this.config,function(e,n){var t,o=h.logCreated;return"function"==typeof o?(t=e.filter((function(e){return!1!==o(e)})),p("beforeWrite",t),n(t)):(p("beforeWrite",e),n(e))}),(f=this,setTimeout((function(){var e=void 0===(n=f.config.pvUrl)?"":n,n="undefined"!=typeof location?(null===location||void 0===location?void 0:location.pathname)+(null===location||void 0===location?void 0:location.hash):void 0;e&&n!==f.originFireUrl&&(f.sendPipeline([function(n,t){t({url:e,type:N.PV})}],N.PV)(null),n)&&location&&(f.originFireUrl=n)}),100),function(e,n){n(e)}),(u=c=s=!1,l=[],(r=this).lifeCycle.on("onConfigChange",(function(){a&&clearTimeout(a),a=setTimeout((function(){var e,n;!u&&r.config&&(u=!0,e=r.config.whiteListUrl,(n=void 0===e?"":e)&&r.sendPipeline([function(e,t){t({url:n,type:N.WHITE_LIST,success:function(e){c=!0;try{var n=e.data||JSON.parse(e),t=n.retcode,o=n.result,i=void 0===o?{}:o,a=(0===t&&(s=i.is_in_white_list,r.isWhiteList=s,0<=i.rate)&&i.rate<=1&&(r.config.random=i.rate,r.isGetSample=!1),r.isWhiteList&&l.length?Y(r)(l.splice(0),(function(){})):!r.isWhiteList&&l.length&&(l.length=0),r.config.onWhitelist);"function"==typeof a&&a(s)}catch(e){}},fail:function(){c=!0}})}],N.WHITE_LIST)(null),u=!1)}),r.config.uin?50:500)})),r.lifeCycle.on("destroy",(function(){l.length=0})),function(e,n){var t;s||null!=(t=null==(t=r.config)?void 0:t.api)&&t.reportRequest?n(e.concat(l.splice(0)).map((function(e){return G(e),e}))):(t=e.filter((function(e){return e.level!==I.INFO&&e.level!==I.API_RESPONSE?(G(e),!0):(c||(l.push(e),200<=l.length&&(l.length=200)),!1)}))).length&&n(t)}),function(e,n){try{var t=JSON.parse(JSON.stringify(e)),o=(m.lifeCycle.emit("beforeReport",t),m.config.beforeReport);(e="function"==typeof o?e.filter((function(e){return!1!==o(e)})):e).length&&n(e)}catch(e){}},Y(this)]),this.eventPipeline=L([R(this,10),(i=this,function(e){i.sendPipeline([function(e,n){var t=e.map((function(e){return{name:e.name,ext1:e.ext1||i.config.ext1||"",ext2:e.ext2||i.config.ext2||"",ext3:e.ext3||i.config.ext3||""}}));n({url:i.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(t)),type:N.EVENT,log:e})}],N.EVENT)(e)})]),this.timeMap={},this.failRequestCount=0,this.customTimePipeline=L([R(this,10),(o=this,function(e){return o.sendPipeline([function(e,n){n({url:o.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:N.CUSTOM,log:e})}],N.CUSTOM)(e)})]),this.config=(t=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),t.url=t.url||e+"/collect",t.offlineUrl=t.offlineUrl||e+"/offline",t.whiteListUrl=t.whiteListUrl||e+"/collect/whitelist",t.pvUrl=t.pvUrl||e+"/collect/pv",t.eventUrl=t.eventUrl||e+"/collect/events",t.speedUrl=t.speedUrl||e+"/speed",t.customTimeUrl=t.customTimeUrl||e+"/speed/custom",t.performanceUrl=t.performanceUrl||e+"/speed/performance",t.webVitalsUrl=t.webVitalsUrl||e+"/speed/webvitals",t.setDataReportUrl=t.SetDataReportUrl||e+"/speed/miniProgramData",t),ce.instances.push(this)}function ue(e,n,t){return null!=n&&n.length&&"object"==typeof e?n.reduce((function(n,o){var i=e instanceof Headers?e.get(o):e[o];return i?n+(""===n?"\n":"\n\n")+t+" header "+o+": "+i:n}),""):""}function le(e){var n,t="";return"object"==typeof e&&(n=(e=function(e,n){for(var t=0;t<n.length;t++){var o=n[t],i=e[o]||"function"==typeof e.get&&e.get(o);if(i)return[o,i]}return["",""]}(e,Object.keys(Oe)))[0],e=e[1],n)?Oe[n](e):t}ae.macos=function(){return A("mac")},ae.ios=function(){return ae.iphone()||ae.ipod()||ae.ipad()},ae.iphone=function(){return!ae.windows()&&A("iphone")},ae.ipod=function(){return A("ipod")},ae.ipad=function(){var e="MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;return A("ipad")||e},ae.android=function(){return!ae.windows()&&A("android")},ae.androidPhone=function(){return ae.android()&&A("mobile")},ae.androidTablet=function(){return ae.android()&&!A("mobile")},ae.blackberry=function(){return A("blackberry")||A("bb10")},ae.blackberryPhone=function(){return ae.blackberry()&&!A("tablet")},ae.blackberryTablet=function(){return ae.blackberry()&&A("tablet")},ae.windows=function(){return A("windows")},ae.windowsPhone=function(){return ae.windows()&&A("phone")},ae.windowsTablet=function(){return ae.windows()&&A("touch")&&!ae.windowsPhone()},ae.fxos=function(){return(A("(mobile")||A("(tablet"))&&A(" rv:")},ae.fxosPhone=function(){return ae.fxos()&&A("mobile")},ae.fxosTablet=function(){return ae.fxos()&&A("tablet")},ae.meego=function(){return A("meego")},ae.cordova=function(){return window.cordova&&"file:"===location.protocol},ae.nodeWebkit=function(){return"object"==typeof window.process},ae.mobile=function(){return ae.androidPhone()||ae.iphone()||ae.ipod()||ae.windowsPhone()||ae.blackberryPhone()||ae.fxosPhone()||ae.meego()},ae.tablet=function(){return ae.ipad()||ae.androidTablet()||ae.blackberryTablet()||ae.windowsTablet()||ae.fxosTablet()},ae.desktop=function(){return!ae.tablet()&&!ae.mobile()};var fe,de,pe,he,ge,me,ve,ye=!(ae.isIE=function(){return"ActiveXObject"in window}),we=[],be=/^\/[^/]/,Ee=!1,Re=[],Oe={sw8:function(e){return(e=e.split("-")[1])?atob(e):""},traceparent:function(e){return e.split("-")[1]},b3:function(e){return e.split("-")[0]},"sentry-trace":function(e){return e.split("-")[0]}},Te=(new ee({name:"reportApiSpeed"}),new ee({name:"reportApiSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideFetch(e.config),this.overrideXhr(e.config))},getRequestType:function(e,n,t){var o,i;return void 0===n&&(n=""),e="function"==typeof(null==(i=e.api)?void 0:i.resourceTypeHandler)?null==(i=e.api)?void 0:i.resourceTypeHandler(t):"",-1===f.indexOf(e)&&(o=void 0===n?"":n,i=(void 0===t?"":t).split("?")[0],e=q.test(i)||j.some((function(e){return-1!==String(o).indexOf(e)}))?"static":"fetch"),e},overrideFetch:function(e){var n=this,t={name:this.name,then:function(t,o,i,r){var a,s;E(i,e.hostUrl)||(a=t.headers?t.headers.get("content-type"):"","fetch"===(s=n.getRequestType(e,a,i))?t.clone().text().then((function(a){var c,u=t.status<=0||400<=t.status,l=(null==(l=e.api)?void 0:l.reqHeaders)||[],f=ue(null==r?void 0:r.headers,l,"req"),d=(l=(null==(l=e.api)?void 0:l.resHeaders)||[],ue(t.headers,l,"res")),p=le(null==r?void 0:r.headers),h=(l=w(a,e.api,{url:i,ctx:t,payload:null==r?void 0:r.body})).code,g=l.isErr,m=(l=null==(l=e.api)?void 0:l.apiDetail)?b(null==r?void 0:r.body,null==(c=e.api)?void 0:c.reqParamHandler,{url:i}):"",v=l?b(a,null==(c=e.api)?void 0:c.resBodyHandler,{url:i,ctx:t}):"";setTimeout((function(){var c=n.getPerformanceEntryByUrl(e,{url:i,duration:o,type:s,status:t.status||0,method:(null==r?void 0:r.method)||"get"}),l=(u?"FETCH_ERROR: "+a+" \n\n":"")+"fetch req url: "+i+" \n                    \nres status: "+(t.status||0)+" \n                    \nres duration: "+c.duration+"ms \n                    \nreq method: "+((null==r?void 0:r.method)||"get")+" \n                    \nres retcode: "+h+"\n                    \nreq param: "+m+"\n                    \nres data: "+v+"\n                    "+f+"\n                    "+d;c.payload=null==r?void 0:r.body,c.ret=h,c.isErr=+g,n.publishNormalLog({msg:l,level:u?I.AJAX_ERROR:g?I.RET_ERROR:I.API_RESPONSE,code:h,trace:p}),n.publishSpeed(c)}),0)})):setTimeout((function(){var a=n.getPerformanceEntryByUrl(e,{url:i,duration:o,type:s,status:t.status||0,method:(null==r?void 0:r.method)||"get"});a.type="static",a.urlQuery=m(i,!0),n.publishSpeed(a)}),0))},catch:function(t,o,i,r){var a,s,c,u,l;throw E(i,e.hostUrl)||(a=n.getRequestType(e,"",i),s=(null==(s=e.api)?void 0:s.reqHeaders)||[],c=ue(null==r?void 0:r.headers,s,"req"),u=le(null==r?void 0:r.headers),l=null!=(s=e.api)&&s.apiDetail?b(null==r?void 0:r.body,null==(s=e.api)?void 0:s.reqParamHandler,{url:i}):"",setTimeout((function(){var s=n.getPerformanceEntryByUrl(e,{url:i,duration:o,type:a,status:0,method:(null==r?void 0:r.method)||"get"});n.publishSpeed(s),s="AJAX_ERROR: "+t+"\n                          \nreq url: "+i+"\n                          \nres status: 0\n                          \nres duration: "+s.duration+"ms\n                          \nreq method: "+((null==r?void 0:r.method)||"get")+"\n                          \nreq param:"+l+"\n                          "+c,n.publishNormalLog({msg:s,level:I.AJAX_ERROR,code:-400,trace:u})}),0)),t}},o=(this.hackFetchOptions=t,this.hackFetchOptions);if(Re.find((function(e){return e.name===o.name})))throw new Error("name '"+o.name+"' is already in hackFetch option list");Re.push(o),!Ee&&window.fetch&&(Ee=!0,he=window.fetch,window.fetch=function(e,n){void 0===n&&(n={});var t="string"==typeof e?e:null==e?void 0:e.url;be.test(t)&&(t=""+location.origin+t);for(var o=0;o<Re.length;o++){var i=Re[o];try{"function"==typeof i.beforeFetch&&i.beforeFetch(t,n)}catch(e){}}var r=Date.now();return he(e,n).then((function(e){for(var o=e.clone(),i=0;i<Re.length;i++){var a=Re[i];try{"function"==typeof a.then&&a.then(o,Date.now()-r,t,n)}catch(e){}}return o})).catch((function(e){for(var o=0;o<Re.length;o++){var i=Re[o];try{"function"==typeof i.catch&&i.catch(e,Date.now()-r,t,n)}catch(e){}}throw e}))})},overrideXhr:function(e){var n,t=this,o={name:this.name,send:function(n,o){var i=Date.now();n.addEventListener("loadend",(function(){var r,a,s,c,u=n.aegisUrl||"";E(u,e.hostUrl)||(r="",(n.failType||!n.status||400<=n.status)&&(r=n.failType||"failed"),a=Date.now()-i,s=n.getResponseHeader("content-type"),c=t.getRequestType(e,s,u),setTimeout((function(){var i=t.getPerformanceEntryByUrl(e,{url:u,duration:a,type:c,status:n.status,method:n.aegisMethod||"get"});if("fetch"===c){var s=(null==(s=e.api)?void 0:s.reqHeaders)||[],l=ue(n.aegisXhrReqHeader,s,"req"),f=(s=(null==(s=e.api)?void 0:s.resHeaders)||[],n.getAllResponseHeaders().split("\r\n").reduce((function(e,n){return(n=n.split(": "))[0]&&n[1]&&(e[n[0]]=n[1]),e}),{})),d=ue(f,s,"res"),p=le(n.aegisXhrReqHeader),h=(s=null==(f=e.api)?void 0:f.apiDetail)?b(o,null==(f=e.api)?void 0:f.reqParamHandler,{url:u}):"",g=s?b(n.response,null==(f=e.api)?void 0:f.resBodyHandler,{url:u}):"";try{var v,y,w,E,R=n.response,O=e.api,T={url:u,ctx:n,payload:o},S=function(e){var n=e.code,a=(e=e.isErr,(r?"AJAX_ERROR: request "+r+" \n\n":"")+"fetch req url: "+u+" \n                      \nres status: "+i.status+"\n                      \nres duration: "+i.duration+"ms\n                      \nreq method: "+i.method+"\n                      \nres retcode: "+n+"\n                      \nreq param: "+h+"\n                      \nres data: "+g+"\n                      "+l+"\n                      "+d);i.ret=n,i.isErr=+e,i.payload=o,t.publishNormalLog({msg:a,level:r?I.AJAX_ERROR:e?I.RET_ERROR:I.API_RESPONSE,code:n,trace:p}),t.publishSpeed(i)};try{if("function"==typeof(null==O?void 0:O.retCodeHandlerAsync))return void O.retCodeHandlerAsync(R,null==T?void 0:T.url,null==T?void 0:T.ctx,(function(e){var n=e.code;e=e.isErr,null!=S&&S({code:void 0===n?"unknown":n,isErr:e})}));if("function"==typeof(null==O?void 0:O.retCodeHandler))return w=(y=O.retCodeHandler(R,null==T?void 0:T.url,null==T?void 0:T.ctx,null==T?void 0:T.payload)||{}).code,E=y.isErr,void(null!=S&&S({code:void 0===w?"unknown":w,isErr:E}));"string"==typeof R&&(R=JSON.parse(R)),"function"==typeof(null==(v=null==O?void 0:O.ret)?void 0:v.join)&&(U=[].concat(O.ret.map((function(e){return e.toLowerCase()}))));var P=Object.getOwnPropertyNames(R).filter((function(e){return-1!==U.indexOf(e.toLowerCase())}));if(P.length)return w=R[P[0]],void(null!=S&&S({code:""+w,isErr:0!==w&&"0"!==w}));null!=S&&S({code:"unknown",isErr:!1})}catch(R){null!=S&&S({code:"unknown",isErr:!1})}}catch(s){i.ret="unknown",t.publishSpeed(i)}}else i.type="static",i.urlQuery=m(u,!0),t.publishSpeed(i)}),0))})),n.addEventListener("timeout",(function(){n.failType="timeout"})),n.addEventListener("error",(function(){n.failType="error"})),n.addEventListener("abort",(function(){n.failType="abort"}))}};this.hackXHROptions=o,n=this.hackXHROptions,we.find((function(e){return e.name===n.name}))||(we.push(n),!ye&&window.XMLHttpRequest&&(fe=window.XMLHttpRequest.prototype.send,de=window.XMLHttpRequest.prototype.open,pe=window.XMLHttpRequest.prototype.setRequestHeader,ye=!0,window.XMLHttpRequest.prototype.open=function(){this.aegisMethod=arguments[0];var e=arguments[1];if(be.test(e)&&(e=""+location.origin+e),this.aegisUrl=e,this.aegisXhrStartTime=Date.now(),this.sendByAegis)ae.isIE()||(this.timeout=5e3);else for(var n=0;n<we.length;n++){var t=we[n];try{"function"==typeof t.open&&t.open(this)}catch(e){}}return de.apply(this,arguments)},window.XMLHttpRequest.prototype.setRequestHeader=function(){var e=arguments[0],n=arguments[1];return this.aegisXhrReqHeader=this.aegisXhrReqHeader||{},this.aegisXhrReqHeader[e]=n,pe.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<we.length;e++){var n=we[e];try{"function"==typeof n.send&&n.send(this,arguments[0])}catch(e){}}return fe.apply(this,arguments)}))},getPerformanceEntryByUrl:function(e,n){return null!=(e=e.api)&&e.usePerformanceTiming&&"string"==typeof n.url&&(e=null==(e=performance.getEntriesByName(n.url))?void 0:e.pop())?{url:n.url,isHttps:y(n.url),method:n.method,type:n.type,status:n.status,duration:Number(e.duration.toFixed(2)),nextHopProtocol:e.nextHopProtocol||"",domainLookup:g(e.domainLookupEnd-e.domainLookupStart),connectTime:g(e.connectEnd-e.connectStart)}:{url:n.url,isHttps:y(n.url),method:n.method,type:n.type,status:n.status,duration:Number(n.duration.toFixed(2)),nextHopProtocol:"",domainLookup:s.number,connectTime:s.number}},publishSpeed:function(e){var n=this;this.$walk((function(t){var o=n.$getConfig(t);"fetch"===e.type&&o&&"function"==typeof o.urlHandler?t.speedLogPipeline(i(i({},e),{url:m(o.urlHandler(e.url,e.payload))})):(e.url=m(e.url),t.speedLogPipeline(e))}))},publishNormalLog:function(e){this.$walk((function(n){n.normalLogPipeline(e)}))},destroy:function(){var e,n,t;this.option.publishSpeed=function(){},this.option.publishNormalLog=function(){},this.option.hackXHROptions&&(e=this.option.hackXHROptions,-1!==(t=we.findIndex((function(n){return n.name===e.name})))&&we.splice(t,1),window.XMLHttpRequest.prototype.send=fe,window.XMLHttpRequest.prototype.open=de,window.XMLHttpRequest.prototype.setRequestHeader=pe,ye=!1),this.option.hackFetchOptions&&(n=this.option.hackFetchOptions,-1!==(t=Re.findIndex((function(e){return e.name===n.name})))&&Re.splice(t,1),window.fetch=he,Ee=!1),this.option.override=!1}})),Se={},Pe=new ee({name:"reportBridgeSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideBridge(e))},publishSpeed:function(e){this.$walk((function(n){n.speedLogPipeline(e)}))},overrideBridge:function(e){var n=this,t=e.config;t.reportBridgeSpeed&&t.h5Bridge&&t.h5BridgeFunc.length&&t.h5BridgeFunc.forEach((function(e){var o=t.h5Bridge[e];Se[e]=o,t.h5Bridge[e]=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var r=e[0],a=e[1],s=e[2],c=e[3],u=Date.now();o(r,a,s,(function(e){var o=(i=w(e,t.api)).code,i=i.isErr;o={url:r+"-"+a,name:r+"-"+a,duration:Date.now()-u,type:"bridge",ret:o,isErr:+i},n.publishSpeed(o),c(e)}))}}))},unHackBridge:function(e){Object.keys(Se).forEach((function(n){Se[n]&&(e.config.h5Bridge[n]=Se[n])})),Se={}},destroy:function(e){this.option.publishSpeed=function(){},this.option.unHackBridge(e),this.option.override=!1}});function Le(e,n,t,o){return void 0===t&&(t=3e4),void 0===o&&(o=0),(n=void 0===n?0:n)<=e&&e<=t?e:o}(Ue=ge=ge||{})[Ue.unknown=100]="unknown",Ue[Ue.wifi=1]="wifi",Ue[Ue.net2g=2]="net2g",Ue[Ue.net3g=3]="net3g",Ue[Ue.net4g=4]="net4g",Ue[Ue.net5g=5]="net5g",Ue[Ue.net6g=6]="net6g",(Ue=me=me||{})[Ue.android=1]="android",Ue[Ue.ios=2]="ios",Ue[Ue.windows=3]="windows",Ue[Ue.macos=4]="macos",Ue[Ue.linux=5]="linux",Ue[Ue.other=100]="other",(Ue=ve=ve||{})[Ue.unknown=100]="unknown",Ue[Ue.normal=0]="normal",Ue[Ue.weak=1]="weak",Ue[Ue.disconnected=2]="disconnected";var xe,Ce,ke,Ae,Ie,Ne,_e,je,qe,Ue=new ee({name:"device",onNewAegis:function(e){e.extendBean("platform",this.getPlatform()),e.extendBean("netType",ge.unknown),this.getDpi(e),this.refreshNetworkTypeToBean(e),this.refreshNetworkStatusToBean(e)},getDpi:function(e){e.extendBean("vp",Math.round(window.innerWidth)+" * "+Math.round(window.innerHeight)),window.screen&&e.extendBean("sr",Math.round(window.screen.width)+" * "+Math.round(window.screen.height))},getPlatform:function(){var e={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT)/,macos:/\b(Mac OS)/,linux:/\b(Linux)/i},n=Object.keys(e).find((function(n){return e[n].test(navigator.userAgent)}));return n?me[n]:me.other},refreshNetworkTypeToBean:function(e){var n=this,t=e.config;t&&("function"==typeof t.getNetworkType?t.getNetworkType:He)((function(t){ge[t]||(t=ge.unknown),e.extendBean("netType",t),n.NetworkRefreshTimer=setTimeout((function(){n.refreshNetworkTypeToBean(e),clearTimeout(n.NetworkRefreshTimer)}),1e4)}))},refreshNetworkStatusToBean:function(e){var n,t=this,o=e.config;o&&null!=(n="function"==typeof o.getNetworkStatus?o.getNetworkStatus:n)&&n((function(n){void 0===ve[n]&&(n=ve.unknown),e.extendBean("netStatus",n),t.NetworkStatusRefreshTimer=setTimeout((function(){t.refreshNetworkStatusToBean(e),clearTimeout(t.NetworkStatusRefreshTimer)}),1e4)}))}}),He=function(e){var n="",t=navigator.userAgent.match(/NetType\/(\w+)/);t?n=t[1]:navigator.connection&&(n=navigator.connection.effectiveType||navigator.connection.type),e((t=n=n||"unknown",0<=(t=String(t).toLowerCase()).indexOf("4g")?ge.net4g:0<=t.indexOf("wifi")?ge.wifi:0<=t.indexOf("5g")?ge.net5g:0<=t.indexOf("6g")?ge.net6g:0<=t.indexOf("3g")?ge.net3g:0<=t.indexOf("2g")?ge.net2g:ge.unknown))},Be=window.WebSocket,Fe=[],De={construct:function(e,n){var t=new e(n[0],n[1]);return t.originSend=t.send,t.addEventListener("error",(function(e){var n=(e=(null==e?void 0:e.currentTarget)||{}).url,t=e.readyState;null!=Fe&&Fe.forEach((function(e){null!=(e=e.onErr)&&e({msg:"无法获知具体错误信息，需在浏览器控制台查看！",readyState:t,connectUrl:n})}))})),Object.defineProperty(t,"send",{get:function(){return function(e){null!=(n=t.originSend)&&n.call(t,e);var n=t.readyState,o=(e=WebSocket.OPEN,WebSocket.CLOSED),r=WebSocket.CONNECTING,a=WebSocket.CLOSING;if(n!==e){var s={readyState:n,connectUrl:t.url};switch(n){case o:Fe.forEach((function(e){null!=(e=e.sendErr)&&e(i({msg:"消息发送失败，连接已关闭！"},s))}));break;case r:Fe.forEach((function(e){(0,e.sendErr)(i({msg:"消息发送失败，正在连接中！"},s))}));break;case a:Fe.forEach((function(e){(0,e.sendErr)(i({msg:"消息发送失败，连接正在关闭！"},s))}))}}}}}),t}},Me=new ee({name:"onError"}),We=Me=new ee({name:"onError",onNewAegis:function(e){this.startListen(e)},startListen:function(e){function n(e){(e=e&&B(e.reason))&&c.publishErrorLog({msg:"PROMISE_ERROR: "+e,level:I.PROMISE_ERROR})}function t(n){var t;if(n=(null==n?void 0:n.target)||(null==n?void 0:n.srcElement)){var o=n.src||n.href||"";if(n=void 0===(n=n.tagName)?"script":n,!(E(t=o,e.config.hostUrl)||-1<window.location.href.indexOf(t))){var i={msg:n+" load fail: "+o,level:I.INFO};if(/\.js$/.test(o))i.level=I.SCRIPT_ERROR;else if(/\.css$/.test(o))i.level=I.CSS_ERROR;else switch(n.toLowerCase()){case"script":i.level=I.SCRIPT_ERROR;break;case"link":i.level=I.CSS_ERROR;break;case"img":i.level=I.IMAGE_ERROR;break;case"audio":case"video":i.level=I.MEDIA_ERROR;break;default:return}c.publishErrorLog(i)}}}var o,i,a,s,c=this,u=window.onerror;window.onerror=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];c.publishErrorLog({msg:(B(e[0])||"")+" @ ("+(B(e[1])||"")+":"+(e[2]||0)+":"+(e[3]||0)+")\n          \n"+B(e[4]||""),level:I.ERROR}),null!=u&&u.call.apply(u,r([window],e))},window.addEventListener("unhandledrejection",n),window.document.addEventListener("error",t,!0),e.lifeCycle.on("destroy",(function(){0===Me.countInstance()&&(window.document.removeEventListener("unhandledrejection",n),window.document.removeEventListener("error",t,!0))})),e.config.websocketHack&&(o={key:e.config.id+"-"+this.name,onErr:function(e){var n;null!=(n=c.publishWsErrorLog)&&n.call(c,e)},sendErr:function(e){var n;null!=(n=c.publishWsErrorLog)&&n.call(c,e)}},this.hackWebsocketConfig=o,o=this.hackWebsocketConfig,window.Proxy)&&window.WebSocket&&(i=window.WebSocket,window&&!i.isHack&&(a=new Proxy(WebSocket,De),i.isHack=!0,window.WebSocket=a),s=o,Fe.find((function(e){return e.key===s.key}))||s&&Fe.push(s))},publishErrorLog:function(e){this.$walk((function(n){n.normalLogPipeline(e)}))},publishWsErrorLog:function(e){var n=e.connectUrl,t=e.msg;e=e.readyState,this.publishErrorLog({msg:"WEBSOCKET_ERROR: \n              connect: "+n+"\n              readyState: "+e+"\n              msg: "+t,level:I.WEBSOCKET_ERROR})},destroy:function(){var e,n;this.option.publishErrorLog=function(){},this.option.hackWebsocketConfig&&(e=this.option.hackWebsocketConfig,window.WebSocket=Be,-1!==(n=Fe.findIndex((function(n){return n.key===e.key}))))&&Fe.splice(n,1)}}),Xe=(new ee({name:"pagePerformance"}),3),Ve=new ee({name:"pagePerformance",onNewAegis:function(e){C()&&(xe?this.publish(xe,e):this.startCalcPerformance(e))},publish:function(e,n){var t=this;n.sendPipeline([function(e,o){var i,r=[];for(i in e)r.push(i+"="+e[i]);var a,s=t.$getConfig(n);if(s)return a=-1===n.config.performanceUrl.indexOf("?")?"?":"&","function"==typeof s.urlHandler?o({url:n.config.performanceUrl+a+r.join("&")+"&from="+(encodeURIComponent(s.urlHandler())||window.location.href),beanFilter:["from"],type:N.PERFORMANCE,log:e}):o({url:n.config.performanceUrl+a+r.join("&"),type:N.PERFORMANCE,log:e})}],N.PERFORMANCE)(e)},startCalcPerformance:function(e){var n=this;try{this.getFirstScreenTiming(e,(function(t){var o=performance.timing;o&&(xe={dnsLookup:Le(o.domainLookupEnd-o.domainLookupStart),tcp:Le(o.connectEnd-o.connectStart),ssl:Le(0===o.secureConnectionStart?0:o.requestStart-o.secureConnectionStart),ttfb:Le(o.responseStart-o.requestStart),contentDownload:Le(o.responseEnd-o.responseStart),domParse:Le(o.domInteractive-o.domLoading,0,3e4,1070),resourceDownload:Le(o.loadEventStart-o.domInteractive,0,3e4,1070),firstScreenTiming:Le(Math.floor(t),0,6e4)},(o=e.config).extraPerformanceData&&"{}"!==JSON.stringify(o.extraPerformanceData)&&(o=(t=o.extraPerformanceData).engineInit,t=t.bundleLoad,xe=i(i({},xe),{engineInit:Le(o,0,1e4),bundleLoad:Le(t,0,1e4)})),n.publish(xe,e))}))}catch(e){}},getFirstScreenTiming:function(e,n){e.lifeCycle.on("destroy",(function(){c&&clearTimeout(c)}));var t=this,o=["script","style","link","br"],i=[],r={},a=new MutationObserver((function(e){var n={roots:[],rootsDomNum:[],time:performance.now()};e.forEach((function(e){e&&e.addedNodes&&e.addedNodes.forEach&&e.addedNodes.forEach((function(e){1===e.nodeType&&e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")?(Object.prototype.hasOwnProperty.apply(r,[n.time])||(r[n.time]=[]),r[n.time].push(e)):1!==e.nodeType||-1!==o.indexOf(e.nodeName.toLocaleLowerCase())||t.isEleInArray(e,n.roots)||e.hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(n.roots.push(e),n.rootsDomNum.push(t.walkAndCount(e)||0))}))})),n.roots.length&&i.push(n)})),s=(a.observe(document,{childList:!0,subtree:!0}),function(o){(o=void 0===o?0:o)||(u=0,(f=Object.keys(r)).length?(o=Math.max.apply(null,f),("object"!=typeof(null==(f=e.config)?void 0:f.pagePerformance)||null!=(f=e.config.pagePerformance)&&f.firstScreenInfo)&&(e.firstScreenInfo={element:null==(f=r[o])?void 0:f[0],timing:o,markDoms:r})):i.forEach((function(n){for(var i,r=0;r<n.roots.length;r++)n.rootsDomNum[r]>u&&t.isInFirstScreen(n.roots[r])&&(u=n.rootsDomNum[r],o=n.time,"object"!=typeof(null==(i=e.config)?void 0:i.pagePerformance)||null!=(i=e.config.pagePerformance)&&i.firstScreenInfo)&&(e.firstScreenInfo={element:n.roots[r],timing:o})})),i.length=0,Object.keys(r).forEach((function(e){r[e]=r[e].map((function(e){var n={tagName:e.tagName},t=e.attributes;if(!t)return e;for(var o=0;o<t.length;o++){var i=t[o];i.name&&(n[i.name]=e.getAttribute(i.name))}return n}))})));var u,l=(f=performance.timing).domInteractive-f.domLoading,f=f.loadEventStart-f.domInteractive,d=o;c=null;for(var p=0,h=[l,f,d];p<h.length;p++)if(h[p]<=0&&0<Xe){c=setTimeout((function(){return s(d)}),3e3);break}c?--Xe:(a.disconnect(),null!=n&&n(o))}),c=setTimeout((function(){return s()}),3e3)},isEleInArray:function(e,n){return!(!e||e===document.documentElement)&&(-1!==n.indexOf(e)||this.isEleInArray(e.parentElement,n))},isInFirstScreen:function(e){var n,t;return!(!e||"function"!=typeof e.getBoundingClientRect)&&(e=e.getBoundingClientRect(),n=window.innerHeight,t=window.innerWidth,0<=e.left)&&e.left<t&&0<=e.top&&e.top<n&&0<e.width&&0<e.height},walkAndCount:function(e){var n=0;if(e&&1===e.nodeType){n+=1;var t=e.children;if(null!=t&&t.length)for(var o=0;o<t.length;o++)n+=this.walkAndCount(t[o])}return n}});function Ge(){Ie=[],ke=-1,Ce=null,Ke(addEventListener)}function Je(e,n){Ce||(Ce=n,ke=e,Ae=new Date,Ke(removeEventListener),$e())}function $e(){var e;0<=ke&&ke<Ae-_e&&(e={entryType:"first-input",name:Ce.type,target:Ce.target,cancelable:Ce.cancelable,startTime:Ce.timeStamp,processingStart:Ce.timeStamp+ke},Ie.forEach((function(n){n(e)})),Ie=[])}function Ke(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(n){return e(n,je,Ne)}))}function Qe(e,n){var t=fn(),o="navigate";return 0<=un?o="back-forward-cache":t&&(o=document.prerendering||0<dn()?"prerender":document.wasDiscarded?"restore":t.type.replace(/_/g,"-")),{name:e,value:void 0===n?-1:n,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:o}}function Ye(e,n,t){try{var o;if(PerformanceObserver.supportedEntryTypes.includes(e))return(o=new PerformanceObserver((function(e){Promise.resolve().then((function(){n(e.getEntries())}))}))).observe(Object.assign({type:e,buffered:!0},t||{})),o}catch(e){}}function ze(e,n,t,o){var i,r;return function(a){0<=n.value&&(a||o)&&((r=n.value-(i||0))||void 0===i)&&(i=n.value,n.delta=r,n.rating=(a=n.value)>t[1]?"poor":a>t[0]?"needs-improvement":"good",e(n))}}function Ze(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))}function en(e){function n(n){"pagehide"!==n.type&&"hidden"!==document.visibilityState||e(n)}addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)}function nn(e){var n=!1;return function(t){n||(e(t),n=!0)}}function tn(){return pn<0&&((pn=window.webVitals.firstHiddenTime)===1/0&&gn(),ln((function(){setTimeout((function(){pn="hidden"!==document.visibilityState||document.prerendering?1/0:0,gn()}),0)}))),{get firstHiddenTime(){return pn}}}function on(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()}function rn(e,n){n=n||{},on((function(){var t,o=tn(),i=Qe("FCP"),r=Ye("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(r.disconnect(),e.startTime<o.firstHiddenTime)&&(i.value=Math.max(e.startTime-dn(),0),i.entries.push(e),t(!0))}))}));r&&(t=ze(e,i,mn,n.reportAllChanges),ln((function(o){i=Qe("FCP"),t=ze(e,i,mn,n.reportAllChanges),Ze((function(){i.value=performance.now()-o.timeStamp,t(!0)}))})))}))}function an(e){var n=e.name;e=e.value,En[n]=e}Ne={passive:!0,capture:!0},_e=new Date,je=function(e){var n,t,o,i;function r(){Je(t,o),i()}function a(){i()}e.cancelable&&(n=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(t=n,o=e,i=function(){removeEventListener("pointerup",r,Ne),removeEventListener("pointercancel",a,Ne)},addEventListener("pointerup",r,Ne),addEventListener("pointercancel",a,Ne)):Je(n,e))},qe="hidden"===document.visibilityState?0:1/0,addEventListener("visibilitychange",(function e(n){"hidden"===document.visibilityState&&(qe=n.timeStamp,removeEventListener("visibilitychange",e,!0))}),!0),Ge(),self.webVitals={firstInputPolyfill:function(e){Ie.push(e),$e()},resetFirstInputPolyfill:Ge,get firstHiddenTime(){return qe}};var sn,cn,un=-1,ln=function(e){addEventListener("pageshow",(function(n){n.persisted&&(un=n.timeStamp,e(n))}),!0)},fn=function(){return window.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||function(){var e,n=performance.timing,t=performance.navigation.type,o={entryType:"navigation",startTime:0,type:2==t?"back_forward":1===t?"reload":"navigate"};for(e in n)"navigationStart"!==e&&"toJSON"!==e&&(o[e]=Math.max(n[e]-n.navigationStart,0));return o}())},dn=function(){var e=fn();return e&&e.activationStart||0},pn=-1,hn=function(e){"hidden"===document.visibilityState&&-1<pn&&(pn="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("visibilitychange",hn,!0),removeEventListener("prerenderingchange",hn,!0))},gn=function(){addEventListener("visibilitychange",hn,!0),addEventListener("prerenderingchange",hn,!0)},mn=[1800,3e3],vn=[.1,.25],yn=[100,300],wn=[2500,4e3],bn={},En=(new ee({name:"webVitals"}),{FCP:-1,LCP:-1,FID:-1,CLS:-1}),Rn=new ee({name:"webVitals",onNewAegis:function(e){if(C()&&"function"==typeof window.PerformanceObserver&&"function"==typeof performance.getEntriesByName)try{rn(an),r=an,a={},on((function(){function e(e){(e=e[e.length-1])&&e.startTime<o.firstHiddenTime&&(i.value=Math.max(e.startTime-dn(),0),i.entries=[e],n())}var n,t,o=tn(),i=Qe("LCP"),s=Ye("largest-contentful-paint",e);s&&(n=ze(r,i,wn,a.reportAllChanges),t=nn((function(){bn[i.id]||(e(s.takeRecords()),s.disconnect(),bn[i.id]=!0,n(!0))})),["keydown","click"].forEach((function(e){addEventListener(e,t,!0)})),en(t),ln((function(e){i=Qe("LCP"),n=ze(r,i,wn,a.reportAllChanges),Ze((function(){i.value=performance.now()-e.timeStamp,bn[i.id]=!0,n(!0)}))})))})),o=an,i={},on((function(){function e(e){e.startTime<t.firstHiddenTime&&(r.value=e.processingStart-e.startTime,r.entries.push(e),s(!0))}function n(n){n.forEach(e)}var t=tn(),r=Qe("FID"),a=Ye("first-input",n),s=ze(o,r,yn,i.reportAllChanges);a&&en(nn((function(){n(a.takeRecords()),a.disconnect()}))),console.warn('The web-vitals "base+polyfill" build is deprecated. See: https://bit.ly/3aqzsGm'),a||window.webVitals.firstInputPolyfill(e),ln((function(){r=Qe("FID"),s=ze(o,r,yn,i.reportAllChanges),window.webVitals.resetFirstInputPolyfill(),window.webVitals.firstInputPolyfill(e)}))})),n=an,t={},rn(nn((function(){function e(e){e.forEach((function(e){var n,t;e.hadRecentInput||(n=a[0],t=a[a.length-1],r&&e.startTime-t.startTime<1e3&&e.startTime-n.startTime<5e3?(r+=e.value,a.push(e)):(r=e.value,a=[e]))})),r>i.value&&(i.value=r,i.entries=a,o())}var o,i=Qe("CLS",0),r=0,a=[],s=Ye("layout-shift",e);s&&(o=ze(n,i,vn,t.reportAllChanges),en((function(){e(s.takeRecords()),o(!0)})),ln((function(){i=Qe("CLS",r=0),o=ze(n,i,vn,t.reportAllChanges),Ze((function(){return o()}))})),setTimeout(o,0))}))),k(this.publish.bind(this,e),!0)}catch(e){}var n,t,o,i,r,a},publish:function(e){var n;null!=(n=e.sendPipeline)&&n.call(e,[function(n,t){var o,i=[];for(o in n)i.push(o+"="+n[o]);var r=-1===e.config.performanceUrl.indexOf("?")?"?":"&";t({url:e.config.webVitalsUrl+r+i.join("&"),type:N.VITALS,log:n,sendBeacon:!0})}],N.VITALS)(En)},destroy:function(){this.option.publish=function(){}}}),On=0,Tn=(o(cn=Ln,Z=sn=Z),cn.prototype=null===Z?Object.create(Z):(xn.prototype=Z.prototype,new xn),Ln.prototype.getBean=function(e){var n=this;return void 0===e&&(e=[]),""+Object.getOwnPropertyNames(this.bean).filter((function(n){return-1===e.indexOf(n)})).map((function(e){return"from"===e?"from="+n.getCurrentPageUrl():e+"="+n.bean[e]})).join("&")},Ln.prototype.getCurrentPageUrl=function(){var e=this.config.pageUrl||location.href;return e=(e="function"==typeof this.config.urlHandler?this.config.urlHandler():e).slice(0,2048),encodeURIComponent(e)},Ln.prototype.ready=function(){var e=this;(function n(){var t,o,i,r;e.reportRequestQueue.length&&(t=e.reportRequestQueue.splice(0,1)[0],o=t.options,i=t.success,r=t.fail,e.$request(o,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return null==i?void 0:i.apply(o,e)}finally{n()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return null==r?void 0:r.apply(o,e)}finally{n()}})))})(),this.isReportReady=!0},Ln.prototype.request=function(e,n,t){this.config.reportImmediately||this.isReportReady?this.$request(e,n,t):this.reportRequestQueue.push({options:e,success:n,fail:t})},Ln.prototype.$request=function(e,n,t){var o,i,r,a;if(e&&"string"==typeof e.url&&""!==e.url&&this.bean.id)return a=e.url,!1!==e.addBean&&(a=a+(-1===a.indexOf("?")?"?":"&")+this.getBean(e.beanFilter)),e.url=a,a=e.method||"get",(e=(i=this.config.onBeforeRequest)?i(e,this):e)?e.url?void((null!=e&&e.sendBeacon||this.sendNow)&&"function"==typeof(null===navigator||void 0===navigator?void 0:navigator.sendBeacon)?navigator.sendBeacon(e.url,e.data):((o=new XMLHttpRequest).sendByAegis=!0,o.addEventListener("readystatechange",(function(){4===o.readyState&&(400<=o.status||0===o.status?null!=t&&t(o.response):null!=n&&n(o.response))})),"get"===a.toLocaleLowerCase()?(o.open("get",(i=e.url,r=e.data,"string"!=typeof i?"":"object"==typeof r&&r?(a=Object.getOwnPropertyNames(r).map((function(e){var n=r[e];return e+"="+("string"==typeof n?encodeURIComponent(n):encodeURIComponent(JSON.stringify(n)))})).join("&").replace(/eval/gi,"evaI"),i+(-1===i.indexOf("?")?"?":"&")+a):i)),o.send()):(o.open("post",e.url),e.contentType&&o.setRequestHeader("Content-Type",e.contentType),"string"==typeof e.data&&(e.data=e.data.replace(/eval/gi,"evaI")),o.send(e.data)))):console.warn("Please handle the parameters reasonably, options.url is necessary"):console.warn("Sending request blocked")},Ln.useAsyncPlugin=function(e,n){var t,o=void 0===(t=(n=void 0===n?{}:n).exportsConstructor)?"aegis-plugin-"+On:t,i=void 0===(t=n.onAegisInit)?function(){}:t,r=void 0===(t=n.onAegisInitAndPluginLoaded)?function(){}:t;if(On+=1,"string"!=typeof e)throw new TypeError("useAsyncPlugin first param must be string");if("function"!=typeof i||"function"!=typeof r)throw new TypeError("onAegisInit and onAegisInitAndPluginLoaded must be function");this.use(new ee({name:"asyncPlugin",onNewAegis:function(n){try{i(n),Ln.asyncPlugin[e]?r(n,window[Ln.asyncPlugin[e]]):(t=e,a=o,s=function(t){t||(Ln.asyncPlugin[e]=o,t=window[o],r(n,t))},c=document.createElement("script"),u=document.head,"function"==typeof a&&(s=a,a=""),c.src=t,c.setAttribute("name",a),c.name=a,c.setAttribute("crossorigin","anonymous"),c.crossorigin="anonymous",c.defer=!0,c.hasLoaded=!1,c.onreadystatechange=function(){c.hasLoaded||c.readyState&&"loaded"!==c.readyState&&"complete"!==c.readyState||(c.hasLoaded=!0,"function"==typeof s&&s(!1),setTimeout((function(){u.contains(c)&&u.removeChild(c)})))},c.onload=c.onreadystatechange,c.onerror=function(){"function"==typeof s&&s(!0),setTimeout((function(){u.contains(c)&&u.removeChild(c)}))},"complete"===document.readyState?u.appendChild(c):window.addEventListener("load",(function(){u.appendChild(c)})))}catch(t){console.log("error on below is caused by "+e+" "),console.error(t)}var t,a,s,c,u}}))},Ln.prototype.publishPluginsLogs=function(){var e=Ln.installedPlugins.find((function(e){return"reportAssetSpeed"===e.name}));null!=e&&e.option.collectNotReportedLog(this)},Ln.prototype.uploadLogs=function(e,n){var t;void 0===e&&(e={}),void 0===n&&(n={}),null!=(t=this.lifeCycle)&&t.emit("uploadLogs",e,n)},Ln.sessionID="session-"+Date.now(),Ln.asyncPlugin={},Ln.urls={aegisCollect:"https://aegis.qq.com/collect",flog:"https://cdn-go.cn/vasdev/web_webpersistance_v2/v1.8.2/flog.core.min.js"},Ln),Sn=new ee({name:"offlineLog"}),Pn=(Z=Sn=new ee({name:"offlineLog",onNewAegis:function(e){!function(e,n){function t(e){u=e}function o(e){s=s.concat(e)}function r(e,n){c={conds:e=void 0===e?{}:e,params:n=void 0===n?{}:n}}var s=[],c=null,u=null;Tn.useAsyncPlugin(e,{exportsConstructor:"Flog",onAegisInit:function(e){e.lifeCycle.on("beforeWrite",o),e.lifeCycle.on("uploadLogs",r),e.lifeCycle.on("onConfigChange",t)},onAegisInitAndPluginLoaded:function(e,l){var f,d,p,h,g,m,v=void 0===(v=n.dbConfig)?{}:v,y=void 0===(y=n.url)?Tn.urls.aegisCollect:y,w=void 0===(w=n.offlineLogExp)?3:w,b=n.id,E=n.uin;null!=(f=e.lifeCycle)&&f.remove("beforeWrite",o),null!=(f=e.lifeCycle)&&f.remove("uploadLogs",r),null!=(f=e.lifeCycle)&&f.remove("onConfigChange",t),y=Object.assign({lookupUrl:y+"/offlineAuto?id="+b,preservedDay:w,id:b,uin:E,aid:(null==(f=e.bean)?void 0:f.aid)||"",beforeRequest:e.config.beforeRequest,afterRequest:e.config.afterRequest},v,{sessionId:Tn.sessionID});try{var R=new l(y);s.forEach((function(e){R.add(i(i({},e),{level:e.level===I.INFO_ALL?I.INFO:e.level}))})),null!=(d=e.lifeCycle)&&d.on("beforeWrite",(function(e){(e=void 0===e?[]:e).forEach((function(e){R.add(i(i({},e),{level:e.level===I.INFO_ALL?I.INFO:e.level}))}))})),null!=(p=e.lifeCycle)&&p.on("uploadLogs",(function(t,o){var i;void 0===t&&(t={}),void 0===o&&(o={}),R.uploadLogs(Object.assign({id:n.id,uin:n.uin,aid:null==(i=e.bean)?void 0:i.aid},t),o)})),null!=(h=e.lifeCycle)&&h.on("onConfigChange",(function(e){R.setConfig(e)})),null!=(g=e.lifeCycle)&&g.on("destroy",(function(){0===Sn.countInstance()&&(s.length=0,"function"==typeof((c=null)==R?void 0:R.destroy))&&R.destroy()})),R.on("PERREVENT",(function(t){e.sendPipeline([function(e,t){o={msg:B(e),level:I.INFO};var o=(o=Array.isArray(o)?o:[o]).map((function(e,n){return Object.getOwnPropertyNames(e).map((function(t){return a(t)+"["+n+"]="+(void 0===e[t]?"":a(e[t]))})).join("&")})).join("&")+(o.length?"&count="+o.length:"");t({type:N.OFFLINE,data:o,contentType:"application/x-www-form-urlencoded",method:"post",addBean:!1,url:n.url+"?id=893&sessionId="+Tn.sessionID+"&uin="+n.uin+"&from="+n.id+"&count=1&version=1.38.70",log:e})}],N.OFFLINE)(t)})),u&&(R.setConfig(u),u=null),c&&(null!=(m=e.lifeCycle)&&m.emit("uploadLogs",c.conds,c.params),c=null),e.flog=R}catch(e){console.log(e)}}})}(Tn.urls.flog,e.config)}}),new ee({name:"spa"}),new ee({name:"spa",init:function(){history.pushState=this.wr("pushState")||history.pushState,history.replaceState=this.wr("replaceState")||history.replaceState,this.sendPv=this.sendPv.bind(this),this.onPageChange()},onPageChange:function(){window.addEventListener("replaceState",this.sendPv),window.addEventListener("pushState",this.sendPv),window.addEventListener("popstate",this.sendPv),window.addEventListener("hashchange",this.sendPv)},wr:function(e){var n=history[e],t="__"+e+"__hasWrittenByTamSpa";return"function"==typeof n&&!history[t]&&(Object.defineProperty(history,t,{value:!0,enumerable:!1}),function(){var t=n.apply(this,arguments),o=null;return"function"==typeof Event?o=new Event(e):(o=document.createEvent("HTMLEvents")).initEvent(e,!1,!0),window.dispatchEvent(o),t})},sendPv:function(){var e=this;setTimeout((function(){var n=location.href,t=location.pathname+location.hash;e.$walk((function(e){var o=e.config.pvUrl;o&&t&&t!==e.originFireUrl&&(e.sendPipeline([function(e,t){t({url:o+"?from="+encodeURIComponent(n),beanFilter:["from"],type:N.PV})}],N.PV)(null),e.originFireUrl=t)}))}),0)},destroy:function(){window.removeEventListener("replaceState",this.option.sendPv),window.removeEventListener("pushState",this.option.sendPv),window.removeEventListener("popstate",this.option.sendPv)}}));function Ln(e){var n,t,o,r,a=sn.call(this,e)||this;a.sendNow=!1,a.isReportReady=!1,a.reportRequestQueue=[],a.speedLogPipeline=L([R(a),(r=a.config,function(e,n){var t,o,i,a="number"==typeof r.repeat?r.repeat:60;!r.speedSample||a<=0?n(e):(t=(null==r?void 0:r.id)||"0",o=$[t]||{},Array.isArray(e)?(i=e.filter((function(e){var n=!o[e.url]||o[e.url]<a;return n?(o[e.url]=1+~~o[e.url],$[t]=o):J[t]||K(t),n}))).length&&n(i):!o[e.url]||o[e.url]<a?(o[e.url]=1+~~o[e.url],$[t]=o,n(e)):J[t]||K(t))}),(o=a,function(e,n){He((function(t){o.extendBean("netType",t),n(e)}))}),function(e,n){null!=(t=a.lifeCycle)&&t.emit("beforeReportSpeed",e);var t,o=a.config.beforeReportSpeed;if((e="function"==typeof o?e.filter((function(e){return!1!==o(e)})):e).length)return n(e)},function(e){return a.sendPipeline([function(e,n){var t,o,r,s;n({type:N.SPEED,url:""+a.config.speedUrl,method:"post",data:(n=e,t=i(i({},a.bean),{from:a.getCurrentPageUrl()}),r={fetch:[],static:[],bridge:[]},s=new FormData,Array.isArray(n)?n.forEach((function(e){var n=te(e);r[e.type].push(n)})):(o=te(n),r[n.type].push(o)),s.append("payload",F(i({duration:r},t))),s),log:e})}],N.SPEED)(e)}]),e.asyncPlugin=!0;try{"undefined"!=typeof document&&(e.uin=e.uin||(null!=(n=document.cookie.match(/\buin=\D+(\d*)/))?n:[])[1]||(null!=(t=document.cookie.match(/\bilive_uin=\D*(\d+)/))?t:[])[1]||""),a.init(e),a.extendBean("sessionId",Ln.sessionID),a.extendBean("from",a.getCurrentPageUrl()),"undefined"!=typeof document&&a.extendBean("referer",encodeURIComponent(document.referrer||"")),e.ext1&&a.extendBean("ext1",encodeURIComponent(e.ext1)),e.ext2&&a.extendBean("ext2",encodeURIComponent(e.ext2)),e.ext3&&a.extendBean("ext3",encodeURIComponent(e.ext3))}catch(e){console.warn(e),console.log("%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact us for feedback and thank you for your support.","color: red"),a.sendSDKError(e)}return a}function xn(){this.constructor=cn}new ee({name:"ie"}),new ee({name:"onClose"});var Cn=new ee({name:"onClose",onNewAegis:function(){var e,n=this;ae.desktop()?(e=window.onunload,window.onunload=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];n.publishNotReportedLog(),null!=e&&e.call.apply(e,r([window],t))}):k(this.publishNotReportedLog.bind(this),!0)},publishNotReportedLog:function(){var e=this;this.$walk((function(n){n.sendNow=!0,n.publishPluginsLogs(),e.publishThrottlePipeLogs(n)}))},publishThrottlePipeLogs:function(e){null!=e&&e.speedLogPipeline([]),null!=e&&e.eventPipeline([]),null!=e&&e.customTimePipeline([]),null!=e&&e.normalLogPipeline([])}});return new ee({name:"aid"}),Tn.use(We),Tn.use(Te),Tn.use(ie),Tn.use(Ve),Tn.use(Rn),Tn.use(ne),Tn.use(Ue),Tn.use(Z),Tn.use(Pn),Tn.use(Cn),Tn.use(Pe),Tn}()},function(e,n,t){"use strict";t.r(n),t.d(n,"AegisReport",(function(){return a}));var o=t(0),i=t.n(o);function r(e){if(window.performance&&window.performance.timing)for(const n in window.performance.timing)if("navigationStart"!==n){let t=window.performance.timing[n]-window.performance.timing.navigationStart;Number.isNaN(t)||(t<0&&(t=0),e.reportTime(n,t))}}function a(e){const n={reportApiSpeed:!0,reportAssetSpeed:!0,beforeRequest:function(e){return(!e.logType||"log"!==e.logType||(n=e.logs.msg,!["oth.str.beacon.qq.com","otheve.beacon.qq.com","h.trace.qq.com/kv","q-ui.cdn-go.cn/qq-theme"].some((function(e){return n.indexOf(e)>-1}))))&&(window.g_aegis&&e.logType&&"performance"===e.logType&&e.logs.firstScreenTiming>1200&&window.g_aegis.infoAll({msg:"QPAGE_PERFORMANCE_SLOW",ext1:"firstScreenTiming: "+e.logs.firstScreenTiming,ext2:"",ext3:"",trace:""}),e);var n}};"number"==typeof e?n.id=e:"string"!=typeof e||Number.isNaN(Number(e))?"string"==typeof e?n.id=e:"object"==typeof e&&Object.assign(n,e):n.id=Number(e);const t=new i.a(n);let o=null;return window.addEventListener("load",()=>{clearTimeout(o),setTimeout(()=>{r(t)},1e3)}),o=setTimeout(()=>{r(t)},3e3),t}n.default=a}])}));